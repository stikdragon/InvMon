<Model>
	<Field id="TIMESTAMP" type="TIMESTAMP" />

	<Field id="INV_MODE" type="string" width="16" />
	<Repeat group="inverters">
		<Field id="INV_$_TEMP" type="float" />
		<Field id="INV_$_BUS_V" type="float" />
	</Repeat>

	<Field id="GRID_V" type="voltage" />
	<Field id="GRID_I" type="current" />
	<Field id="GRID_F" type="freq" />
	<Field id="LOAD_F" type="freq" />
	<Field id="BATT_V" type="voltage" />
	
	<Repeat group="inverters">
		<Field id="INV_$_I" type="current" />
	</Repeat>
	<Field id="INV_I" type="current" calculatedRepeat="[INV_$_I],sum" repeatGroup="inverters" />
	<Field id="BATT_SOC" type="float" />
	<Field id="BATT_MODE" type="string" width="16" />

	<Field id="LOAD_V" type="voltage" />
	<Repeat group="inverters">
		<Field id="LOAD_$_I" type="current" />
		<Field id="LOAD_$_P" type="power" calculated="[LOAD_V], [LOAD_$_I], *" />
	</Repeat>
	<Field id="LOAD_PF" type="float" />
	<Field id="LOAD_P" type="power" calculatedRepeat="[LOAD_$_P],sum" repeatGroup="inverters" />
	<Field id="LOAD_I" type="current" calculatedRepeat="[LOAD_$_I],sum" repeatGroup="inverters" />

	<Repeat group="inverters">
		<Field id="PVA_$_V" type="voltage" />
		<Field id="PVB_$_V" type="voltage" />

		<Field id="PVA_$_I" type="current" />
		<Field id="PVB_$_I" type="current" />

		<Field id="PVA_$_P" type="power" />
		<Field id="PVB_$_P" type="power" />

		<Field id="PV_$_P" type="power" calculated="[PVA_$_P], [PVB_$_P], +" />
	</Repeat>

	<Field id="PV_TOTAL_P" type="power" calculatedRepeat="[PV_$_P],sum" repeatGroup="inverters" />

	<Repeat group="batteries">
		<Field id="BATT_$_I" type="current" />
	
		<Field id="BATT_$_C1" type="voltage" />
		<Field id="BATT_$_C2" type="voltage" />
		<Field id="BATT_$_C3" type="voltage" />
		<Field id="BATT_$_C4" type="voltage" />
		<Field id="BATT_$_C5" type="voltage" />
		<Field id="BATT_$_C6" type="voltage" />
		<Field id="BATT_$_C7" type="voltage" />
		<Field id="BATT_$_C8" type="voltage" />
		<Field id="BATT_$_C9" type="voltage" />
		<Field id="BATT_$_C10" type="voltage" />
		<Field id="BATT_$_C11" type="voltage" />
		<Field id="BATT_$_C12" type="voltage" />
		<Field id="BATT_$_C13" type="voltage" />
		<Field id="BATT_$_C14" type="voltage" />
		<Field id="BATT_$_C15" type="voltage" />
		<Field id="BATT_$_C16" type="voltage" />
		<Field id="BATT_$_C17" type="voltage" />
		<Field id="BATT_$_C18" type="voltage" />
		<Field id="BATT_$_C19" type="voltage" />
		<Field id="BATT_$_C20" type="voltage" />
		<Field id="BATT_$_C21" type="voltage" />
		<Field id="BATT_$_C22" type="voltage" />
		<Field id="BATT_$_C23" type="voltage" />
		<Field id="BATT_$_C24" type="voltage" />
	</Repeat>

<!-- 	<Field id="BATT_I" type="current" calculatedRepeat="[BATT_$_I],sum" repeatGroup="batteries" /> -->
	<Field id="BATT_I" type="current" calculatedRepeat="[INV_$_I],sum" repeatGroup="inverters" />
	
	<Field id="BATT_I_CHG" type="current" calculated="[BATT_I], !invert, 0, !max" />
	<Field id="BATT_I_DIS" type="current" calculated="[BATT_I], 0, !max" />
</Model>